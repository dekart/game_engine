<% builder.buttons do %>
  <%= link_to_function(button(:request_help), stream_dialog(:mission_help, mission),
        :class => "request_help button"
      ) if Setting.b(:stream_dialog_enabled) && Setting.b(:mission_help_enabled) %>

  <%= link_to(button(:try_again), fulfill_mission_path(mission),
        :method => :post,
        :"data-click-once" => true,
        :class => "fulfill_again button"
      ) %>
<% end %>

<% builder.fail do %>
  <%= t(".message") %> <%= mission.failure_text.to_s.html_safe %>
<% end %>

<%= builder.render("missions/fulfill/payouts", 
      :mission  => mission, 
      :result   => result
    ) %>

<% builder.on_ready do %>
  var mission = $('#<%= dom_id(mission) %>');

  mission.replaceWith('<%= escape_javascript(render('mission', :mission => mission, :level => result.level, :rank => result.level_rank)) %>');
  
  <%= ga_track_event('Missions',
        result.level_rank.completed? ? 'Repeat Failure' : 'Failure', 
        "#{mission.name} - Level #{result.level.position}", 
        result.level_rank.progress
      ) %>
<% end %>