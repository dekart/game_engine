<% if form.object.new_record? or form.object.character_type.nil? %>
  <%= form.hidden_field :character_type_id %>

  <% types = capture do %>
    <div id="character_types" class="clearfix">
      <% @character_types.each do |type| %>
        <% link_text = capture do %>
          <span class="name"><%= type.name %></span>
          <%= image_tag(type.image.url(:small)) if type.image? %>
        <% end %>

        <%= link_to_function(link_text.strip, "Character.setCharacterType(#{type.id})",
              :id     => dom_id(type),
              :class  => :character_type
            ) %>
      <% end %>
    </div>
  <% end %>

  <% type_descriptions = capture do %>
    <div id="character_type_descriptions">
      <% @character_types.each do |type| %>
        <% if type.description.present? %>
          <% content_tag :div, :class => :description, :id => dom_id(type, :description), :style => "display:none;" do %>
            <%= type.description %>
          <% end %>
        <% end %>
      <% end %>
    </div>
  <% end %>

  <%= form.field :character_type, types, :after_field => type_descriptions, :label => t(".labels.character_type") %>

  <% if type = form.object.character_type || @character_types.first %>
    <% content_for :script do %>
      Character.setCharacterType(<%= type.id %>)
    <% end %>
  <% end %>
<% end %>

<%= form.text_field :name, :label => t(".labels.name") %>