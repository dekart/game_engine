<% dialog :level_up_notification do |d| %>
  <h2><%= t(".title") %></h2>

  <div class="text">
    <%= t(".text",
          :point_amount => Setting.i(:character_points_per_upgrade)
        ).html_safe %>
  </div>

  <div class="buttons">
    <%= link_to_function(button(:publish), stream_dialog(:level_up, :callback => "$(document).trigger('character.level_up_publish')"),
          :class => "publish button"
        ) if Setting.b(:stream_dialog_enabled) %>
        
    <%= link_to(button(:upgrade), upgrade_character_url(current_character),
          :remote => true,
          :class => "upgrade button"
        ) %>
  </div>

  <%= render("notifications/disable", :notification => notification) %>

  <% d.on_ready do %>
    $(document).trigger('character.new_level');

    $(document).one('character.level_up_publish', function(){
      $.get('<%= upgrade_character_url(current_character) %>');
    });

    <%= ga_track_event('Character', 'Level Up', 'Level', current_character.level) %>
  <% end %>
<% end %>
