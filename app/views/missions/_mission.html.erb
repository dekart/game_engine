<% content_tag_for(:tr, mission) do %>
  <td class="info">
    <div class="image">
      <% if mission.image? %>
        <%= image_tag(mission.image.url(:small)) %>
      <% else %>
        <%= asset_image_tag(:mission_placeholder) %>
      <% end %>
    </div>

    <div class="name"><%= mission.name %></div>
    <div class="description"><%= mission.description.to_s.html_safe %></div>

    <div class="controls">
      <% if mission.repeatable? || rank.nil? || !rank.completed? %>
        <%= link_to_remote(button(rank.nil? || rank.progress == 0 ? :start : :fulfill),
              :url    => fulfill_mission_path(mission),
              :update => :result,
              :html   => {
                :"data-click-once" => true,
                :class => "fulfill button"
              }
            ) %>
      <% else %>
        <div class="completed"><%= t('.completed') %></div>
      <% end %>
    </div>

    <div class="progress"><%= mission_progress(rank) %></div>
  </td>
  <td class="details">
    <div class="payouts">
      <h3><%= Mission.human_attribute_name("payouts") %></h3>

      <%= payout(:experience, level.experience) %>
      <%= payout(:basic_money, mission_money(level)) %>

      <%= payout_list(level, level.applicable_payouts,
            :format   => :preview,
            :triggers => rank.next_payout_triggers
          ) %>
    </div>

    <div class="requirements">
      <h3><%= Mission.human_attribute_name("requirements") %></h3>

      <%= attribute_requirement(:energy, level.energy, current_character.ep >= level.energy) %>

      <%= requirement_list(mission.requirements) %>
    </div>
  </td>
<% end %>
