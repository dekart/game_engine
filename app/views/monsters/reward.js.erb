<%= render_to_result(:monster) do |builder| %>
  <% if @reward_collected %>
    <% builder.success do %>
      <%= t(".messages.success",
            :monster => strong_tag(@fight.monster.name)
          ).html_safe %>
    <% end %>

    <% builder.buttons do %>
      <%= link_to_function(button(:publish),
            stream_dialog(:monster_defeated, @fight.monster, :before => 'DialogController.close();'),
            :class => "publish button"
          ) if Setting.b(:stream_dialog_enabled) %>
    <% end %>

    <table class="payouts">
      <tr>
        <td class="received">
          <h3><%= t(".you_received") %></h3>

          <%= payout_list(@fight, @fight.payouts) %>
        </td>
      </tr>
    </table>

    <% builder.on_ready do %>
      <%= ga_track_event('Monsters', 'Reward Collected', @fight.monster.name, @fight.damage) %>
    <% end %>
  <% elsif @fight.reward_collected? %>
    <% builder.fail do %>
      <%= t(".messages.already_collected").html_safe %>
    <% end %>

    <% builder.on_ready do %>
      <%= ga_track_event('Monsters', 'Reward Already Collected', @fight.monster.name) %>
    <% end %>
  <% elsif !@fight.will_get_reward? %>
    <% builder.fail do %>
      <%= t(".messages.insignificant_damage").html_safe %>
    <% end %>

    <% builder.on_ready do %>
      <%= ga_track_event('Monsters', 'Insignificant Damage', @fight.monster.name, @fight.damage) %>
    <% end %>
  <% end %>

  <% builder.on_ready do %>
    $('#monster').html('<%= escape_javascript(render(@fight.monster.state, :monster => @fight.monster, :fight => @fight)) %>');
  <% end %>
<% end %>