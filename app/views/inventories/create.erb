<% result_for :shop do |builder| %>
  <% if @inventory.valid? %>
    <% builder.buttons do %>
      <%= link_to_function(button(:publish), inventory_stream_dialog(@inventory),
            :class => "publish button"
          ) %>
      
      <%= link_to(button(:inventory), inventories_url, 
            :class => "inventory button"
          ) %>
    <% end %>

    <% builder.success do %>
      <%=  t(".messages.success",
            :amount     => @amount,
            :item_name  => content_tag(:b, @amount > 1 ? @item.plural_name : @item.name)
          ).html_safe %>
    <% end %>

    <% if @item.price? %>
      <table class="payouts">
        <tr>
          <td class="spent">
            <h3><%= t(".you_spent.title") %></h3>

            <% if @item.basic_price > 0 %>
              <%= payout(:basic_money, number_to_currency(@inventory.basic_money)) %>
            <% end %>

            <% if @item.vip_price > 0 %>
              <%= payout(:vip_money, number_to_currency(@inventory.vip_money)) %>
            <% end %>
          </td>
        </tr>
      </table>
    <% end %>

    <% builder.on_ready do %>
      $('#inventory_fight_attributes').html('<%= escape_javascript(render("characters/fight_attributes")) %>');

      Character.initFightAttributes();

      $(document).trigger('item.purchase');
    <% end %>
  <% else %>
    <% builder.fail do %>
      <%= @inventory.errors.on(:character) %>
    <% end %>
  <% end %>
<% end %>