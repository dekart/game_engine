<% if @character == current_character %>
  <%= title(t(".title_my", :user => character_name(@character))) %>
<% else %>
  <%= title(
        t(".title",
          :user => character_name(@character,
            :possessive => true,
            :capitalize => true
          )
        )
      ) %>
<% end %>

<div id="character">
  <div class="controls">
    <% if @character == current_character %>
      <%= link_to_remote(button(:upgrade),
            :url    => upgrade_character_path(@character),
            :method => :get,
            :update => :ajax,
            :html   => {:class => "upgrade button"}
          ) if current_character.points > 0 %>
    <% else %>
      <%= link_to_remote(button(:attack),
            :url    => fights_path(:victim_id => @character),
            :update => :result,
            :html   => {:class => "attack button"}
          ) if current_character.can_attack?(@character) %>

      <%= link_to(button(:hitlist), new_character_hit_listing_path(@character),
            :class => "hitlist button"
          ) if Setting.b(:hit_list_enabled) %>
    <% end %>
  </div>

  <table class="info" cellspacing="0" cellpadding="0">
    <tr>
      <td><%= render "characters/attributes", :character => @character %></td>
      <td><%= render "characters/statistics", :character => @character %></td>
      <td class="rank_list">
        <% if @character.titles.any? %>
          <% @character.titles.each do |title| %>
            <%= content_tag(:div, title, :class => :rank) %>
          <% end %>
        <% else %>
          <% if @character == current_character %>
            <%= t(".titles.empty_set_my") %>
          <% else %>
            <%= raw t(".titles.empty_set",
                  :user => character_name(@character,
                    :firstnameonly  => true,
                    :capitalize     => true
                  )
                ) %>
          <% end %>
        <% end %>
      </td>
    </tr>
  </table>

  <% ItemGroup.find_each do |group| %>
    <% collection(@character.inventories.by_item_group(group), :empty_set => false) do |items| %>
      <div class="item_group">
        <h2><%= group.name %></h2>

        <div class="items clearfix">
          <% items.each do |inventory| %>
            <div class="item">
              <%= item_image(inventory, :small) %>

              <% if @character == current_character %>
                <div class="amount">
                  <%= raw t(".items.amount",
                        :name   => inventory.name,
                        :amount => inventory.amount
                      ) %>
                </div>
              <% end %>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>
  <% end %>

  <% collection(@character.properties, :empty_set => false) do |properties| %>
    <div class="properties">
      <h2><%= t(".properties.title") %></h2>

      <div class="items clearfix">
        <% properties.each do |property| %>
          <div class="item">
            <%= property_image(property, :small) %>

            
            <div class="name">
              <% if @character == current_character %>
                <%= raw t(".properties.name",
                      :name  => property.name,
                      :level => property.level
                    ) %>
              <% else %>
                <%= property.name %>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>

  <% if Setting.b(:wall_enabled) %>
    <div class="wall">
      <h2>
        <%= raw t(".wall.title",
              :user => character_name(@character, :possessive => true, :capitalize => true)
            ) %>
      </h2>

      <%= character_wall(@character) %>
    </div>
  <% end %>
</div>