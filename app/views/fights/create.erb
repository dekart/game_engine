<% result_for :fight do %>
  <% if !@fight.new_record? %>
    <% if @fight.winner == current_character %>
      <div class="buttons">
        <%= link_to_function(button(:publish), fight_stream_dialog(@fight),
              :class => "publish button"
            ) %>

        <%= help_request_link(button(:request_help), @fight,
              :class => "request_help button"
            ) %>
      </div>

      <%= render "fights/create/success", :fight => @fight %>
    <% else %>
      <div class="buttons">
        <%= link_to_remote(button(:attack_again),
              :url    => @fight.cause ? respond_fight_path(@fight.cause) : fights_path(:victim_id => @victim),
              :update => :result,
              :html   => {:class => "attack_again button"}
            ) %>

        <%= help_request_link(button(:request_help), @fight,
              :class => "request_help button"
            ) %>
      </div>

      <%= render "fights/create/failure", :fight => @fight %>
    <% end %>

    <%= render "fights/create/details", :fight => @fight %>
  <% elsif !@fight.enough_stamina? %>
    <%= render("requirements/not_satisfied/stamina_point",
          :requirement => @fight.stamina_requirement
        ) %>
  <% elsif current_character.weak? %>
    <%= render("requirements/not_satisfied/health_point",
          :requirement => @fight.health_requirement
        ) %>
  <% else %>
    <p class="fail"><%= @fight.errors.on(:character) %></p>
  <% end %>
<% end %>

<%= character_level_up_block %>

<% dom_ready do %>
  <% if @fight.cause %>
    $('#<%= dom_id(@fight.cause, :respond) %>').hide();
  <% end %>

  $(document).trigger('result.received');
<% end %>