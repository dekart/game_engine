<% result_for :hit_listing do %>
  <% if @fight %>
    <% if !@fight.new_record? %>
      <% unless @hit_listing.completed? %>
        <div class="buttons">
          <%= link_to_remote(button(:attack_again),
                :url    => hit_listing_path(@hit_listing),
                :method => :put,
                :update => :result,
                :html   => {:class => "attack_again button"}
              ) %>
        </div>
      <% end %>

      <% if @fight.winner == current_character %>
        <%= render "fights/create/success", :fight => @fight %>
      <% else %>
        <%= render "fights/create/failure", :fight => @fight %>
      <% end %>

      <% if @hit_listing.completed? %>
        <p class="completed">
          <%= t(".completed", :victim => character_name_link(@hit_listing.victim)).html_safe! %>
        </p>

        <table class="payouts" cellspacing="0" cellpadding="0">
          <tr>
            <td class="received">
              <h3><%= t(".you_received") %></h3>

              <%= payout(:basic_money, number_to_currency(@hit_listing.reward)) %>
            </td>
          </tr>
        </table>
      <% else %>
        <p class="incomplete"><%= t(".incomplete") %></p>
      <% end %>
    <% elsif !@fight.enough_stamina? %>
      <%= render("requirements/not_satisfied/stamina_point",
            :requirement => @fight.stamina_requirement
          ) %>
    <% elsif current_character.weak? %>
      <%= render("requirements/not_satisfied/health_point",
            :requirement => @fight.health_requirement
          ) %>
    <% else %>
      <p><%= @fight.errors.on(:character) %></p>
    <% end %>
  <% else %>
    <%= t(".already_completed", :victim => character_name_link(@hit_listing.victim)).html_safe! %>
  <% end %>
<% end %>

<% dom_ready do %>
  <% if @hit_listing.completed? %>
    $('#hitlist').html(<%= render("list", :hit_listings => @hit_listings).to_json.html_safe! %>)
  <% end %>

  $(document).trigger('result.received');
<% end %>