<%= title(
      t(".title",
        :user => character_name(@character, 
          :possessive => true,
          :capitalize => true,
          :useyou     => true
        )
      )
    ) %>

<div id="character">
  <div class="controls">
    <% if @character == current_character %>
      <%= link_to(button(:upgrade), upgrade_character_path(@character),
            :class => "upgrade button"
          ) if current_character.points > 0 %>
    <% else %>
      <%= link_to_remote(button(:attack),
            :url => fights_url(:victim_id => @character, :canvas => false),
            :update => :result,
            :html => {:class => "attack button"}
          ) if current_character.can_attack?(@character) %>
    <% end %>
  </div>

  <table class="info" cellspacing="0" cellpadding="0">
    <tr>
      <td><%= render :partial => "characters/attributes", :locals => {:character => @character} %></td>
      <td><%= render :partial => "characters/statistics", :locals => {:character => @character} %></td>
      <td class="rank_list">
        <% if @character.titles.any? %>
          <% @character.titles.each do |title| %>
            <%= content_tag(:div, title, :class => :rank) %>
          <% end %>
        <% else %>
          <%=raw t(".titles.empty_set", :user => character_name(@character, :firstnameonly => true, :capitalize => true, :useyou => true)) %>
        <% end %>
      </td>
    </tr>
  </table>

  <% ItemGroup.find_each do |group| %>
    <% collection(@character.inventories.by_item_group(group), :empty_set => false) do |items| %>
      <div class="item_group">
        <h2><%= group.name %></h2>

        <div class="items clearfix">
          <% items.each do |inventory| %>
            <div class="item">
              <%= item_image(inventory, :small) %>

              <% if @character == current_character %>
                <div class="amount">
                  <%= raw t(".items.amount",
                        :name   => inventory.name,
                        :amount => inventory.amount
                      ) %>
                </div>
              <% end %>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>
  <% end %>

  <% collection(@character.properties, :empty_set => false) do |properties| %>
    <div class="properties">
      <h2><%= t(".properties.title") %></h2>

      <div class="items clearfix">
        <% properties.each do |property| %>
          <div class="item">
            <%= property_image(property, :small) %>

            <% if @character == current_character %>
              <div class="amount">
                <%= raw t(".properties.amount",
                      :name   => property.name,
                      :amount => property.amount
                    ) %>
              </div>
            <% end %>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>

  <% if Setting.b(:wall_enabled) %>
    <div class="wall">
      <h2>
        <%= raw t(".wall.title",
              :user => character_name(@character, :possessive => true, :capitalize => true)
            ) %>
      </h2>

      <%= character_wall(@character) %>
    </div>
  <% end %>
</div>