<% result_for :fight do |builder| %>
  <% if !@fight.new_record? %>
    <%= builder.render("fights/create/#{ @fight.winner == current_character ? 'success' : 'failure' }", 
          :fight => @fight
        ) %>

    <%= builder.render "fights/create/details", :fight => @fight %>

  <% elsif !@fight.enough_stamina? %>
    <div class="unsatisfied_requirements">
      <%= builder.render("requirements/not_satisfied/stamina_point",
            :requirement => @fight.stamina_requirement
          ) %>
    </div>

    <% builder.on_ready do %>
      <%= ga_track_event('Fights', 'Not Enough Stamina') %>
    <% end %>
  <% elsif current_character.weak? %>
    <div class="unsatisfied_requirements">
      <%= builder.render("requirements/not_satisfied/health_point",
            :requirement => current_character.weakness_requirement
          ) %>
    </div>

    <% builder.on_ready do %>
      <%= ga_track_event('Fights', 'Not Enough Health') %>
    <% end %>
  <% else %>
    <% builder.fail do %>
      <%= @fight.errors.collect{|e| e.last }.join(' ') %>
    <% end %>
  <% end %>

  <% builder.on_ready do %>
    <% if @fight.cause %>
      $('#<%= dom_id(@fight.cause, :respond) %>').remove();
    <% else %>
      $('#<%= dom_id(@fight.victim) %>').remove();
    <% end %>
  
    $(document).trigger('fights.create');
  <% end %>
<% end %>
