<h2><%= t(".title") %></h2>

<% form_for [@assignment.context, @assignment] do |f| %>
  <%= f.hidden_field :role %>
  <%= f.hidden_field :relation_id %>

  <% filters = %w{not_assigned assigned} %>

  <div class="tabs">
    <% filters.each do |filter| %>
      <%= link_to(t(".#{filter}.title"), :anchor => filter) %>
    <% end %>
  </div>

  <% filters.each do |filter| %>
    <div id="<%= filter %>">
      <% if relations = current_character.friend_relations.send(filter) and relations.any? %>
        <table class="relations" cellspacing="0" cellpadding="0">
          <tr>
            <th colspan="3"><%= t(".columns.user") %></th>
            <th><%= t("assignments.roles.#{@assignment.role}.description") %></th>
          </tr>
          <% relations.each do |relation| %>
            <% content_tag_for :tr, relation.becomes(Relation), :value => relation.id do %>
              <td class="picture"><%= character_picture(relation.target_character) %></td>
              <td class="name"><%= character_name(relation.target_character) %></td>
              <td class="level">
                <%= Character.human_attribute_name("level") %>
                <%= relation.target_character.level %>
              </td>
              <td class="effect"><%= assignment_effect(@assignment, relation, :format => :short) %></td>
            <% end %>
          <% end %>
        </table>
      <% else %>
        <div class="empty_set"><%= t(".#{filter}.empty_set") %></div>
      <% end %>
    </div>
  <% end %>

  <%= submit_tag t(".submit") %>
<% end %>

<% dom_ready do %>
  AssignmentForm.setup();

  $(document).trigger('remote_content.received');
<% end %>