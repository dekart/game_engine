<% if @rank %>
  <p>
    <%= fb_i("Well done!") %> <%= fb_i(@mission.won_text) %>
  </p>

  <div class="received">
    <h3><%= fb_i("You received:") %></h3>
    <ul>
      <li>
        <b><%= fb_i("Experience:") %></b>
        <div class="experience"><%= @mission.experience %></div>
      </li>
      <li>
        <b><%= fb_i("Money:") %></b>
        <div class="basic_money"><%= @mission.money %></div>
      </li>
    </ul>
  </div>

  <div class="spent">
    <h3><%= fb_i("You spent") %></h3>
    <ul>
      <li>
        <b><%= fb_i("Energy:") %></b>
        <div class="energy"><%= @mission.experience %></div>
      </li>
    </ul>
  </div>
  
  <% content_for :script do %>
    Mission.setCompleteness(<%= @mission.id %>, '<%= @rank.completeness %>');
  <% end %>

  <% if @rank.completed? %>
    <p>
      <% fb_i do %>
        Congratulations! You completed this mission and received new title: {title}!

        <%= fb_it(:title, content_tag(:b, @mission.winner_title)) %>
      <% end %>
    </p>

    <% content_for :script do %>
      Mission.hideControls(<%= @mission.id %>);
    <% end %>
  <% end %>
<% else %>
  <p>
    <% fb_i do %>
      You don't have enough energy. Take a rest until your energy will grow to {ep_number} points.
      You need to wait about {minute_number} minutes.
      <%= fb_it(:ep_number, @mission.ep_cost) %>
      <%= fb_it(:minute_number, (current_character.ep_restore_time(@mission.ep_cost) / 1.minute).ceil) %>
    <% end %>
  </p>
<% end %>

<% content_for :script do %>
  Mission.showResult();
<% end %>