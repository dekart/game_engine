<%= title(fb_i(t(".title"))) %>

<% if @sent_invitations and @sent_invitations.any? %>
  <% content_for :result do %>
    <div id="invitation_result">
      <p>
        <% fb_i do %>
          <%= t(".success_message") %>

          <%= fb_it(:amount, @sent_invitations.size) %>
        <% end %>
      </p>
    </div>
  <% end %>
<% end %>

<% content_for :invite_message do %>
  <%= fb_i(
        t(".invite.message",
          :user     => fb_name(current_user, :linked => :false),
          :pronoun  => fb_pronoun(current_user, :possessive => true),
          :app_name => fb_app_name
        )
      ) %>

  <% content_tag("fb:req-choice", :url => root_url) do%>
    <%= fb_fa(:label, fb_i(t(".invite.buttons.accept",
          :user => fb_name(current_user,
            :linked         => false,
            :possessive     => true,
            :firstnameonly  => true
          )
        ))) %>
  <% end %>

  <% content_tag("fb:req-choice", :url => character_url(current_character)) do%>
    <%= fb_fa(:label, fb_i(t(".invite.buttons.visit_profile", 
          :user => fb_name(current_user,
            :linked         => false,
            :possessive     => true,
            :firstnameonly  => true
          )))
        ) %>
  <% end %>
<% end %>

<div class="note">
  <%= fb_i(t(".note")) %>
</div>

<table id="invitation_form">
  <tr>
    <td id="request_invitation">
      <div class="invitation_type">
        <h2><%= fb_i(t(".request.title")) %></h2>

        <% fb_request_form(nil, :invite_message, invite_users_path(:from_selector => true)) do %>
          <%= fb_fa(:type, fb_i(t(".invite.title"))) %>

          <% fb_custom_multi_friend_selector(:exclude_ids => (current_user.invitations.facebook_ids + current_character.relations.facebook_ids).uniq.join(","), :condensed => true) do %>
            <%= fb_fa(:actiontext, fb_i(t(".invite.note"))) %>
          <% end %>

          <%= fb_request_form_submit %>
        <% end %>
      </div>

      <div class="invitation_type">
        <h2><%= fb_i(t(".publish.title")) %></h2>

        <p><%= fb_i(t(".publish.note")) %></p>

        <%= link_to_feed_dialog(t(".publish.button"), Publisher::Invitation, :invite,
            :template_data => {
              :pronoun      => fb_pronoun(current_user, :possessive => true, :useyou => false),
              :invite_link  => content_tag(:b, link_to(t(".publish.invite_link"), invitation_url(current_character.id))),
            },
            :image_url => invitation_url(current_character.id),
            :html => {:class => :button}
          ) %>
      </div>
    </td>
    <td id="manual_invitation">
      <div class="invitation_type" id="chat_invitation">
        <h2><%= fb_i(t(".chat.title")) %></h2>
        
        <p><%= fb_i(t(".chat.note")) %></p>

        <%= fb_chat_invite(
              t(".manual.chat.invitation") + invitation_url(current_character.id)
            ) %>
      </div>
      
      <div class="invitation_type">
        <h2><%= fb_i(t(".copy_paste.title")) %></h2>

        <p><%= fb_i(t(".copy_paste.note")) %></p>

        <p class="invitation_text">
          <% fb_i do %>
            <%= t(".copy_paste.invitation") %>
            <%= fb_it(:link, invitation_url(current_character.id)) %>
          <% end %>
        </p>
      </div>
    </td>
  </tr>
</table>
