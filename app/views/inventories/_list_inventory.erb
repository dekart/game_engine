<% content_tag_for(:tr, inventory) do %>
  <td class="picture"><%= item_image(inventory, :small) %></td>
  <td class="info">
    <div class="name"><%= inventory.name %></div>
    <div class="description"><%= inventory.description %></div>
    <div class="stats">
      <div class="owned">
        <%= t(".owned",
              :amount => '<span class="value">%s</span>' % inventory.amount
            ).html_safe %>
      </div>

      <% if inventory.equipped > 0 %>
        <div class="used">
          <%= t(".equipped",
                :amount => '<span class="value">%s</span>' % inventory.equipped
              ).html_safe %>
        </div>
      <% end %>
    </div>
  </td>
  <td class="payouts">
    <%= item_effects(inventory.item) %>
  </td>
  <td class="controls">
    <%= link_to_remote(inventory_use_button(inventory),
          :url    => use_inventory_path(inventory),
          :update => :result,
          :html   => {
            :"data-click-once" => true,
            :class => "use button"
          }
        ) if inventory.usable? %>

    <% if inventory.can_be_sold? %>
      <% form_tag("", :class => :clearfix) do %>
        <%= amount_select_tag %>

        <%= link_to_remote(button(:sell, :price => number_to_currency(inventory.sell_price)),
              :url    => inventory_path(inventory.item),
              :method => :delete,
              :with   => "$(this).parent('form').serialize()",
              :update => :result,
              :confirm  => t(".sell_confirm", :price => number_to_currency(inventory.sell_price)),
              :html   => {
                :"data-click-once" => true,
                :class => "sell button"
              }
            ) %>
      <% end %>
    <% end %>

    <% if inventory.can_be_sold_on_market? and Setting.b(:market_enabled) %>
      <% if inventory.market_items_count == 0 %>
        <%= link_to_remote(button(:sell_on_market),
              :url    => new_market_item_path(:inventory_id => inventory),
              :method => :get,
              :update => :result,
              :html   => {:class => "market button"}
            ) %>
      <% else %>
        <div class="market_listing"><%= t(".listed_on_market") %></div>
      <% end %>
    <% end %>
    
    <% if Setting.b(:inventory_exchange_enabled) && inventory.item.exchangeable %>
      <% if current_character.exchanges.in_exchange?(inventory.item) %>
        <%= link_to(button(:view_exchange), exchange_path(current_character.exchanges.exchange_by(inventory.item).key),
              :class => "exchange button"
            ) %>
      <% else %>
        <%= link_to_remote(button(:exchange),
              :url    => new_exchange_path(:inventory_id => inventory),
              :method => :get,
              :update => :result,
              :html   => {:class => "exchange button"}
            ) %>
      <% end %>
    <% end %>
  </td>
<% end %>